@model IEnumerable<Category>

@{
    ViewData["Title"] = "Category";
}



<!--Category Header-->
<div class="card shadow-sm category-header shadow">
    <div class="card-header">        
        <h3 class="card-title fw-bolder fs-1">
            <div class="symbol symbol-35px me-3">
                <div class="symbol-label fs-2 fw-semibold bg-light text-inverse-primary">
                    <span class="svg-icon svg-icon-2x svg-icon-primary">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path opacity="0.3" d="M21.25 18.525L13.05 21.825C12.35 22.125 11.65 22.125 10.95 21.825L2.75 18.525C1.75 18.125 1.75 16.725 2.75 16.325L4.04999 15.825L10.25 18.325C10.85 18.525 11.45 18.625 12.05 18.625C12.65 18.625 13.25 18.525 13.85 18.325L20.05 15.825L21.35 16.325C22.35 16.725 22.35 18.125 21.25 18.525ZM13.05 16.425L21.25 13.125C22.25 12.725 22.25 11.325 21.25 10.925L13.05 7.62502C12.35 7.32502 11.65 7.32502 10.95 7.62502L2.75 10.925C1.75 11.325 1.75 12.725 2.75 13.125L10.95 16.425C11.65 16.725 12.45 16.725 13.05 16.425Z" fill="currentColor" />
                            <path d="M11.05 11.025L2.84998 7.725C1.84998 7.325 1.84998 5.925 2.84998 5.525L11.05 2.225C11.75 1.925 12.45 1.925 13.15 2.225L21.35 5.525C22.35 5.925 22.35 7.325 21.35 7.725L13.05 11.025C12.45 11.325 11.65 11.325 11.05 11.025Z" fill="currentColor" />
                        </svg>
                    </span>
                </div>
            </div>
            Categories
        </h3>
        <!--<div class="search-box">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search this blog">
                <div class="input-group-append">
                    <form method="post" action="Search">
                        <a class="btn btn-secondary" asp-controller="Categories" asp-action="Search">
                            <i class="fa fa-search"></i>
                        </a>
                    </form>
                </div>
            </div>
        </div>-->
        <div class="card-toolbar">         
            <a class="btn btn-sm btn-light btn-primary fs-4 fw-bolder" asp-controller="Categories" asp-action="Add">
                <i class="bi bi-plus-square-dotted"></i>
                Add Category
            </a>
        </div>
    </div>
</div>

<!--Category Cards-->
<div class="row">
    <div class="d-flex">

    </div>
    @if (!Model.Any())
    {
        <div class="alert alert-warning d-flex align-items-center p-5 mb-10">
            <i class="ki-duotone ki-shield-tick fs-1 text-warning me-4">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor" />
                    <rect x="11" y="14" width="7" height="2" rx="1" transform="rotate(-90 11 14)" fill="currentColor" />
                    <rect x="11" y="17" width="2" height="2" rx="1" transform="rotate(-90 11 17)" fill="currentColor" />
                </svg>
            </i>
            <div class="d-flex flex-column">
                <span class="text-dark fs-3 fw-bold">No Category Found!</span>
            </div>
        </div>
    }
    else
    {
        <div class="table-responsive shadow">
            <div class="actions-row">
                <input type="text" class="form-control form-control h-40px bg-body ps-13 fs-7" name="search" value="" placeholder="Search..." data-kt-search-element="input">
            </div>
            <table class="table category-table table-row-dashed table-row-gray-300 gy-7">
                <thead>
                    <tr class="fw-bold fs-3 text-gray-800">                       
                        <th>
                            Category Name                         
                            <div class="dropup-center dropup options-button">
                                <button class="btn dropdown-toggle-table dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical options-table-button"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Sort ASC</a></li>
                                    <li><a class="dropdown-item" href="#">Sort DSC</a></li>
                                    <li><a class="dropdown-item" href="#">Hide Column</a></li>
                                </ul>
                            </div>
                            
                        </th>
                        <th>
                            Status
                            <div class="dropup-center dropup options-button">
                                <button class="btn dropdown-toggle-table dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical options-table-button"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Sort ASC</a></li>
                                    <li><a class="dropdown-item" href="#">Sort DSC</a></li>
                                    <li><a class="dropdown-item" href="#">Hide Column</a></li>
                                </ul>
                            </div>
                        </th>
                        <th>
                            Creation Date
                            <div class="dropup-center dropup options-button">
                                <button class="btn dropdown-toggle-table dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical options-table-button"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Sort ASC</a></li>
                                    <li><a class="dropdown-item" href="#">Sort DSC</a></li>
                                    <li><a class="dropdown-item" href="#">Hide Column</a></li>
                                </ul>
                            </div>
                        </th>
                        <th>
                            Last Update Date
                            <div class="dropup-center dropup options-button">
                                <button class="btn dropdown-toggle-table dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical options-table-button"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Sort ASC</a></li>
                                    <li><a class="dropdown-item" href="#">Sort DSC</a></li>
                                    <li><a class="dropdown-item" href="#">Hide Column</a></li>
                                </ul>
                            </div>
                        </th>
                        <th>
                            Action
                            <div class="dropup-center dropup options-button" style="display:none;">
                                <button class="btn dropdown-toggle-table dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical options-table-button"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Sort ASC</a></li>
                                    <li><a class="dropdown-item" href="#">Sort DSC</a></li>
                                    <li><a class="dropdown-item" href="#">Hide Column</a></li>
                                </ul>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var category in Model)
                    {
                        <tr class="fs-4">
                            <td>@category.CategoryName</td>
                            <td class="fw-bolder">
                                <span class="badge badge-light-@(@category.IsDeleted ? "danger" : "success") js-status">
                                    @(@category.IsDeleted ? "Deleted" : "Available")
                                </span>          
                            </td>
                            <td>@category.CreatedOn</td>
                            <td>@category.LastUpdatedOn</td>
                            <td>
                                <!--
                                <a class="btn btn-secondary align-self-center" asp-controller="Categories" asp-action="Edit" asp-route-EditId="category.CategoryId">
                                                                    <i class="bi bi-pencil-fill"></i>
                                                                    Edit
                                                                </a>
                                -->
								<div class="card-toolbar">
									<!--begin::Menu-->
									<button type="button" class="btn btn-sm btn-icon btn-color-primary btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
										<!--begin::Svg Icon | path: icons/duotune/general/gen024.svg-->
										<span class="svg-icon svg-icon-2">
											<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
												<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
													<rect x="5" y="5" width="5" height="5" rx="1" fill="currentColor" />
													<rect x="14" y="5" width="5" height="5" rx="1" fill="currentColor" opacity="0.3" />
													<rect x="5" y="14" width="5" height="5" rx="1" fill="currentColor" opacity="0.3" />
													<rect x="14" y="14" width="5" height="5" rx="1" fill="currentColor" opacity="0.3" />
												</g>
											</svg>
										</span>
										<!--end::Svg Icon-->
									</button>
									<!--begin::Menu 3-->
									<div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px py-3" data-kt-menu="true">
										<!--begin::Menu item-->
										<div class="menu-item px-3">
                                            <a asp-controller="Categories" asp-action="Edit" asp-route-EditId="@category.CategoryId" class="menu-link flex-stack px-3">
                                                Edit
                                                </a>
										</div>
										<!--end::Menu item-->
										<!--begin::Menu item-->
										<div class="menu-item px-3">
                                            <a href="javascript:;" data-id="@category.CategoryId" class="menu-link flex-stack px-3 js-toggle-status">
												Change Status
											</a>
										</div>
										<!--end::Menu item-->
																		
									</div>
								</div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@Html.AntiForgeryToken()

@section Scripts{
    <script>
        $(document).ready(function () {
            $('body').delegate('.js-toggle-status', 'click', function () {
                var btn = $(this);

                bootbox.confirm({
                    message: "Are you sure that you need to toggle this item status?",
                    buttons: {
                        confirm: {
                            label: 'Yes',
                            className: 'btn-danger'
                        },
                        cancel: {
                            label: 'No',
                            className: 'btn-secondary'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            $.post({
                                url: '/Categories/ToggleStatus/' + btn.data('id'),
                                data: {
                                    '__RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                                },
                                success: function (lastUpdatedOn) {
                                    var row = btn.parents('tr');
                                    var status = row.find('.js-status');
                                    var newStatus = status.text().trim() === 'Deleted' ? 'Available' : 'Deleted';
                                    status.text(newStatus).toggleClass('badge-light-success badge-light-danger');
                                    row.find('.js-updated-on').html(lastUpdatedOn);
                                    row.addClass('animate__animated animate__shakeX');

                                    Swal.fire({
                                        position: 'center-center',
                                        icon: 'success',
                                        title: 'Updated Successfully!',
                                        showConfirmButton: false,
                                        timer: 1500
                                    })

                                    toastr.options = {
                                        "closeButton": true,
                                        "debug": false,
                                        "newestOnTop": true,
                                        "progressBar": false,
                                        "positionClass": "toastr-bottom-right",
                                        "preventDuplicates": true,
                                        "onclick": null,
                                        "showDuration": "300",
                                        "hideDuration": "1000",
                                        "timeOut": "3000",
                                        "extendedTimeOut": "1000",
                                        "showEasing": "swing",
                                        "hideEasing": "linear",
                                        "showMethod": "fadeIn",
                                        "hideMethod": "fadeOut"
                                    };

                                    toastr.success("Updated Successfully!");
                                },
                                error: function () {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Oops...',
                                        text: 'Something went wrong!',
                                        customClass: {
                                            confirmButton: "btn btn-primary"
                                        }
                                    })
                                }
                            });
                        }
                    }
                });
            });
        });
    </script>
}